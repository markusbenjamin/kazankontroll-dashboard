(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     13501,        359]
NotebookOptionsPosition[     11556,        318]
NotebookOutlinePosition[     12071,        336]
CellTagsIndexPosition[     12028,        333]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"DateDifferenceInUnits", "[", 
   RowBox[{"date1_DateObject", ",", "date2_DateObject", ",", "unit_"}], "]"}],
   ":=", 
  RowBox[{"QuantityMagnitude", "[", 
   RowBox[{"DateDifference", "[", 
    RowBox[{"date1", ",", "date2", ",", "unit"}], "]"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9084526517756166`*^9, 3.908452651776616*^9}},
 CellLabel->"In[1]:="],

Cell[BoxData[
 RowBox[{
  RowBox[{"PrecedingVal", "[", 
   RowBox[{"list_", ",", "val_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"nearestVal", ",", "nearestPos"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"nearestVal", "=", 
      RowBox[{
       RowBox[{"Nearest", "[", 
        RowBox[{"list", ",", "val"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"nearestPos", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Position", "[", 
         RowBox[{"list", ",", "nearestVal"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nearestVal", "<", "val"}], ",", "\[IndentingNewLine]", 
       "nearestVal", ",", "\[IndentingNewLine]", 
       RowBox[{"list", "[", 
        RowBox[{"[", 
         RowBox[{"nearestPos", "-", "1"}], "]"}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.909595160403163*^9, 3.909595172046154*^9}, {
  3.9095953444993*^9, 3.90959536152275*^9}},
 CellLabel->"In[2]:="],

Cell[BoxData[
 RowBox[{
  RowBox[{"PrecedingPos", "[", 
   RowBox[{"list_", ",", "val_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"nearestVal", ",", "nearestPos"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"nearestVal", "=", 
      RowBox[{
       RowBox[{"Nearest", "[", 
        RowBox[{"list", ",", "val"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"nearestPos", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Position", "[", 
         RowBox[{"list", ",", "nearestVal"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nearestVal", "<", "val"}], ",", "\[IndentingNewLine]", 
       "nearestPos", ",", "\[IndentingNewLine]", 
       RowBox[{"nearestPos", "-", "1"}]}], "\[IndentingNewLine]", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.909595552164418*^9, 3.9095955630293283`*^9}},
 CellLabel->"In[3]:="],

Cell[BoxData[
 RowBox[{
  RowBox[{"SparseTimeMovingAverage", "[", 
   RowBox[{"data_List", ",", 
    RowBox[{"windowSize_", "?", "NumericQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "times", ",", "values", ",", "averageValues", ",", "result", ",", 
      "halfWindow", ",", "timeWindowIndices"}], "}"}], ",", 
    RowBox[{"(*", 
     RowBox[{"Extract", " ", "times", " ", "and", " ", "values"}], "*)"}], 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"times", ",", "values"}], "}"}], "=", 
      RowBox[{"Transpose", "[", "data", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Half", " ", "of", " ", "the", " ", "window", " ", "size"}], 
      "*)"}], 
     RowBox[{"halfWindow", "=", 
      RowBox[{"windowSize", "/", "2"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Moving", " ", "average", " ", "calculation"}], "*)"}], 
     RowBox[{"averageValues", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"(*", 
        RowBox[{
        "Find", " ", "indices", " ", "of", " ", "times", " ", "within", " ", 
         "the", " ", "window", " ", "around", " ", "the", " ", "current", " ",
          "time", " ", "point"}], "*)"}], 
       RowBox[{
        RowBox[{
         RowBox[{"timeWindowIndices", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Position", "[", 
            RowBox[{"times", ",", 
             RowBox[{"_", "?", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"Abs", "[", 
                  RowBox[{"#", "-", 
                   RowBox[{"times", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "<=", 
                 "halfWindow"}], "&"}], ")"}]}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "timeWindowIndices", "]"}], ">", "0"}], 
           ",", 
           RowBox[{"Mean", "[", 
            RowBox[{"values", "[", 
             RowBox[{"[", "timeWindowIndices", "]"}], "]"}], "]"}], ",", 
           RowBox[{"(*", 
            RowBox[{
            "Calculate", " ", "mean", " ", "if", " ", "indices", " ", "are", 
             " ", "found"}], "*)"}], 
           RowBox[{"values", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], " ", 
          RowBox[{"(*", 
           RowBox[{
           "Use", " ", "current", " ", "value", " ", "if", " ", "no", " ", 
            "other", " ", "values", " ", "are", " ", "in", " ", "the", " ", 
            "window"}], "*)"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "times", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Combine", " ", "times", " ", "with", " ", "calculated", " ", 
       "averages"}], "*)"}], 
     RowBox[{"result", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"times", ",", "averageValues"}], "}"}], "]"}]}]}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.909672239284593*^9, 3.909672252436393*^9}, 
   3.9096725234075937`*^9},
 CellLabel->"In[4]:="],

Cell[BoxData[
 RowBox[{
  RowBox[{"voltageTimestamps", "=", 
   RowBox[{"StringSplit", "[", 
    RowBox[{
     RowBox[{"Import", "[", 
      RowBox[{
       RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
       "\"\<gas_pulse_times.txt\>\""}], "]"}], ",", "\"\<\\n\>\""}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.909672104701314*^9, 3.9096721516669874`*^9}, {
  3.909672349749567*^9, 3.9096723665026913`*^9}, {3.9096733782092967`*^9, 
  3.9096733788498087`*^9}},
 CellLabel->"In[5]:="],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"startDate", "=", 
  RowBox[{"DateObject", "[", 
   RowBox[{"voltageTimestamps", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9096723542110243`*^9, 3.9096723691074667`*^9}, 
   3.909673383106286*^9},
 CellLabel->"In[6]:="],

Cell[BoxData[
 TemplateBox[{
   RowBox[{"\"Wed 22 Nov 2023 17:11:33\"", 
     StyleBox[
      RowBox[{"\"GMT+\"", "\[InvisibleSpace]", 
        StyleBox["1", NumberMarks -> False, StripOnInput -> False]}], 
      FontColor -> GrayLevel[0.5]]}], 
   RowBox[{"DateObject", "[", 
     RowBox[{
       RowBox[{"{", 
         RowBox[{
          "2023", ",", "11", ",", "22", ",", "17", ",", "11", ",", 
           "33.878875`"}], "}"}], ",", "\"Instant\"", ",", "\"Gregorian\"", 
       ",", "1.`"}], "]"}]},
  "DateObject",
  Editable->False]], "Output",
 CellChangeTimes->{3.9096722536504226`*^9, 3.9096723698341923`*^9, 
  3.909673383661172*^9, 3.909674364196951*^9},
 CellLabel->"Out[6]="]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"timeGranularity", "=", "\"\<Second\>\""}], ";"}]], "Input",
 CellChangeTimes->{{3.909672271748087*^9, 3.9096722808034697`*^9}, {
  3.9096726158587284`*^9, 3.909672618418378*^9}, {3.909672744370235*^9, 
  3.9096727457141995`*^9}, {3.909672867154132*^9, 3.9096728677310004`*^9}},
 CellLabel->"In[7]:="],

Cell[BoxData[
 RowBox[{
  RowBox[{"voltageTimes", "=", 
   RowBox[{"Map", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Round", "[", 
       RowBox[{"DateDifferenceInUnits", "[", 
        RowBox[{"startDate", ",", 
         RowBox[{"DateObject", "[", "#", "]"}], ",", "timeGranularity"}], 
        "]"}], "]"}], "\[IndentingNewLine]", "&"}], ",", 
     "voltageTimestamps"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.9096723720819683`*^9, 3.9096723872669945`*^9}, {
  3.909672897716729*^9, 3.909672900023387*^9}, {3.909673385410671*^9, 
  3.909673390769606*^9}},
 CellLabel->"In[8]:="],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Select", "[", 
  RowBox[{
   RowBox[{"Differences", "[", "voltageTimes", "]"}], ",", 
   RowBox[{
    RowBox[{"60", "<", "#"}], "&"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.9096734717774725`*^9, 3.909673483169407*^9}},
 CellLabel->"In[9]:="],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "61", ",", "266", ",", "136", ",", "119", ",", "92", ",", "147", ",", "254",
    ",", "114", ",", "110", ",", "110", ",", "110", ",", "185", ",", "70", 
   ",", "79", ",", "93", ",", "206", ",", "132", ",", "136", ",", "229", ",", 
   "68", ",", "71", ",", "86", ",", "87", ",", "94", ",", "99", ",", "107", 
   ",", "105", ",", "253", ",", "75", ",", "354", ",", "275", ",", "67", ",", 
   "88", ",", "100", ",", "99", ",", "116", ",", "848", ",", "135", ",", "83",
    ",", "84", ",", "78", ",", "119", ",", "168", ",", "167", ",", "88", ",", 
   "90", ",", "99", ",", "136", ",", "99", ",", "120", ",", "83", ",", "149", 
   ",", "80", ",", "90", ",", "93", ",", "100", ",", "108", ",", "108", ",", 
   "313", ",", "170", ",", "86", ",", "140", ",", "70", ",", "97", ",", "100",
    ",", "93", ",", "96", ",", "107", ",", "106", ",", "334", ",", "77", ",", 
   "243", ",", "153", ",", "168", ",", "78", ",", "94", ",", "107", ",", 
   "131", ",", "173", ",", "166", ",", "71", ",", "98", ",", "168", ",", "89",
    ",", "114", ",", "93", ",", "108", ",", "109"}], "}"}]], "Output",
 CellChangeTimes->{3.90967344405813*^9, 3.9096743666082325`*^9},
 CellLabel->"Out[9]="]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["voltageTimes"], "Input",
 CellLabel->"In[10]:="],

Cell[CellGroupData[{

Cell[BoxData[
 DynamicBox[ToBoxes[
   StringJoin["Making second backup, ", 
    FileNameTake[NotebookBackup`Private`bakfile2$19675], "..."], StandardForm],
  Evaluator->"Local",
  ImageSizeCache->{318.498046875, {3., 9.}}]], "PrintTemporary",
 CellChangeTimes->{3.909675247609504*^9},
 CellLabel->"During evaluation of In[10]:="],

Cell[BoxData[
 DynamicBox[ToBoxes[
   StringJoin["Backing up ", 
    FileNameTake[NotebookBackup`Private`nbfile$19675], " to ", 
    FileNameTake[NotebookBackup`Private`bakfile$19675], "..."], StandardForm],
  
  Evaluator->"Local",
  ImageSizeCache->{404.267578125, {3., 9.}}]], "PrintTemporary",
 CellChangeTimes->{3.909675247664833*^9},
 CellLabel->"During evaluation of In[10]:="]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1536., 831.5999999999999},
WindowMargins->{{-5.3999999999999995`, Automatic}, {
  Automatic, -5.3999999999999995`}},
WindowStatusArea->"analyzer-dashboard.nb last backed up to \
analyzer-dashboard.nb~ on Wed 22 Nov 2023 at 9:39:18 PM",
FrontEndVersion->"12.3 for Microsoft Windows (64-bit) (July 9, 2021)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 419, 10, 70, "Input",ExpressionUUID->"f2001572-1466-450c-b723-8726ce3d9123",
 InitializationCell->True],
Cell[980, 32, 1303, 34, 70, "Input",ExpressionUUID->"147087ce-96b2-4f34-93bf-fd2f309bc847",
 InitializationCell->True],
Cell[2286, 68, 1185, 30, 70, "Input",ExpressionUUID->"a9c4907f-fd73-41bc-91e3-9875d7ea5bd2",
 InitializationCell->True],
Cell[3474, 100, 3235, 83, 70, "Input",ExpressionUUID->"5955a1a7-8af8-43dc-9eaa-187718d3bbc3",
 InitializationCell->True],
Cell[6712, 185, 497, 13, 70, "Input",ExpressionUUID->"447498ea-9669-418e-9783-9c46db10c169"],
Cell[CellGroupData[{
Cell[7234, 202, 283, 7, 70, "Input",ExpressionUUID->"ef670a96-6797-4bf2-abd6-35a13f542a6f"],
Cell[7520, 211, 688, 18, 70, "Output",ExpressionUUID->"17a30f7c-71b8-403c-8c97-3387fe68c414"]
}, Open  ]],
Cell[8223, 232, 335, 6, 70, "Input",ExpressionUUID->"8b9a1429-9c54-4ed9-a4c5-3075ec0299a1"],
Cell[8561, 240, 617, 15, 70, "Input",ExpressionUUID->"3bfb46bd-b884-41d1-9630-c5dc978077b2"],
Cell[CellGroupData[{
Cell[9203, 259, 268, 7, 70, "Input",ExpressionUUID->"3abd9f62-ddaf-461a-a6d6-77af1a73a2eb"],
Cell[9474, 268, 1214, 18, 70, "Output",ExpressionUUID->"ca6c8dad-f7d1-4f0a-8722-28d2220b5102"]
}, Open  ]],
Cell[CellGroupData[{
Cell[10725, 291, 62, 1, 70, "Input",ExpressionUUID->"a48c4635-7d2f-48fa-aba7-3d7098548428"],
Cell[CellGroupData[{
Cell[10812, 296, 329, 7, 70, "PrintTemporary",ExpressionUUID->"969469e0-cc6c-40b7-853d-640d2733f455"],
Cell[11144, 305, 384, 9, 70, "PrintTemporary",ExpressionUUID->"4f15832a-256b-4840-aff6-c55111cab1a4"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
